# Activation Patching
https://arxiv.org/pdf/2404.15255

一种模型解剖方法。是电路连接的“逻辑分析仪”。

## 1. 什么是激活修补？

激活修补（也称为因果追踪或重采样消融）是一种通过替换神经网络内部激活值来研究模型行为的技术。

- **操作方式**：在运行模型时，用来自另一个不同输入（源）的缓存激活值覆盖当前输入（目标）的特定内部激活，观察其对输出的影响。  
- **与消融（Ablation）的区别**：消融通常是将激活值置零，而激活修补是通过“替换”来进行更有针对性和受控的操控，从而精确定位特定的模型电路。

---

## 2. 实验的两种主要模式

论文区分了两种应用场景：

- **探索性模式（Exploratory）**：逐个修补组件（如各层 MLP 或注意力头），以寻找参与特定任务的模型部分并生成假设。  
- **验证性模式（Confirmatory）**：一次性修补多个组件，以验证所发现的电路是否完整且足以执行任务。

---

## 3. 修补的两大方向：去噪与加噪

这是论文强调的关键点，两者并非简单的对称关系：

- **去噪（Denoising, Clean → Corrupt）**：将“干净”输入的激活补入“损坏”输入中。它测试哪些激活是**充分的**，能恢复模型行为。  
- **加噪（Noising, Corrupt → Clean）**：将“损坏”输入的激活补入“干净”输入中。它测试哪些激活是**必要的**，若修补后行为破坏，则说明该组件必不可少。

---

## 4. 评估指标的选择与陷阱

论文详细分析了不同指标对结果解读的影响，建议研究者意识到各指标的局限性：

- **对数几率差（Logit Difference）**：作者最推荐的指标，因为它具有线性特性，能更好地捕捉模型内部的机械处理过程，且不易受无关电路干扰。  
- **概率（Probability）**：由于其非线性（指数级变化）特性，容易产生极其尖锐的修补图，可能导致错误解读。  
- **离散指标（如准确率）**：存在阈值效应，可能漏掉重要的部分贡献者，更适合验证性实验。

---

## 5. 实践建议

- **从低粒度开始**：建议先从残差流修补开始，逐步增加粒度（如注意力头），最后使用路径修补（Path Patching）来测试组件间的直接交互。  
- **谨慎选择损坏提示词（Corrupted Prompts）**：不同的损坏方式会追踪模型不同的属性（如位置、数值或语法结构），需根据研究目的精心设计。
